<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gumo.demo.mapper.UserMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.gumo.demo.entity.User">
        <id column="id" property="id" />
        <result column="userName" property="userName" />
        <result column="passWord" property="passWord" />
        <result column="realName" property="realName" />
        <result column="key_word" property="keyWord" />
    </resultMap>

    <!--实际工作不建议用 *，left join 为空时 存在数据问题 -->
    <resultMap id="GroupResultMap" type="com.gumo.demo.model.vo.UserDeviceVO">
        <id column="id" property="id" />
        <result column="userName" property="userName" />
        <result column="passWord" property="passWord" />
        <result column="realName" property="realName" />
        <collection property="deviceIds" ofType="com.gumo.demo.model.vo.DeviceIdVO" columnPrefix="md_">
            <result column="device_id" property="id"/>
            <result column="device_name" property="name"/>
        </collection>
    </resultMap>

    <update id="updateKeyWordById">
        update user set key_word = #{user.keyWord} where id = #{user.id}
    </update>

    <select id="getUserDevice" resultMap="GroupResultMap">
        select u.*, ud.device_id md_device_id,ud.device_name md_device_name
        from user u
                 left join t_user_device ud on u.id = ud.user_id
        where u.userName = #{userName} and u.passWord = #{passWord}
    </select>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, userName, passWord, realName, key_word
    </sql>

    <select id="queryUserList" resultType="com.gumo.demo.model.vo.UserVO">
        select * from user
    </select>

</mapper>
